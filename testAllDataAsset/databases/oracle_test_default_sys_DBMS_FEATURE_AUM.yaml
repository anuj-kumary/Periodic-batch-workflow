name: DBMS_FEATURE_AUM
fullyQualifiedName: oracle_test.default.sys.DBMS_FEATURE_AUM
storedProcedureCode:
  language: SQL
  code: |2-
           feature_info     OUT  CLOB)
    PROCEDURE dbms_feature_aum
         ( feature_boolean  OUT  NUMBER,
           aux_count        OUT  NUMBER,
    AS
      ts_info         varchar2(1000);
      undo_blocks     number;
      max_concurrency number;
    BEGIN

      select count(*) into feature_boolean from v$system_parameter where
        name = 'undo_management' and upper(value) = 'AUTO';

      if (feature_boolean = 0) then
        /* not automatic undo management */
        aux_count    := 0;
        feature_info := null;
      else

        aux_count := 0;

        /* undo tablespace information */
        for ts_type in
          (select retention, count(*) tcount, sum(size_mb) size_mb
            from
             (select ts.tablespace_name, retention, sum(bytes)/1048576 size_mb
               from dba_data_files df, dba_tablespaces ts
              where df.tablespace_name = ts.tablespace_name
                and ts.contents = 'UNDO'
              group by ts.tablespace_name, retention)
            group by retention)
        loop

          /* track total number of tablespaces */
          aux_count := aux_count + ts_type.tcount;

          ts_info := ts_info ||
              '(Retention: ' || ts_type.retention ||
             ', TS Count: ' || ts_type.tcount ||
             ', Size MB: '  || ts_type.size_mb || ') ';

        end loop;

        /* get some more information */
        select sum(undoblks), max(maxconcurrency)
          into undo_blocks, max_concurrency
          from v$undostat
          where begin_time >=
                 (SELECT nvl(max(last_sample_date), sysdate-7)
                    FROM dba_feature_usage_statistics);

        ts_info := ts_info || '(Undo Blocks: ' || undo_blocks ||
                             ', Max Concurrency: ' || max_concurrency || ') ';

        for ssold in
          (select to_char(min(begin_time), 'YYYY-MM-DD HH24:MI:SS') btime,
                  to_char(max(end_time),   'YYYY-MM-DD HH24:MI:SS') etime,
                  sum(SSOLDERRCNT) errcnt
            from v$undostat
            where (begin_time >=
                   (SELECT nvl(max(last_sample_date), sysdate-7)
                      FROM dba_feature_usage_statistics)))
        loop
          ts_info := ts_info ||
              '(Snapshot Old Info - Begin Time: ' || ssold.btime ||
                            ', End Time: '   || ssold.etime ||
                            ', SSOLD Error Count: ' || ssold.errcnt || ') ';
        end loop;

        feature_boolean := 1;
        feature_info    := to_clob(ts_info);

      end if;

    END dbms_feature_aum;
dataProducts: []
storedProcedureType: StoredProcedure
databaseSchema:
  id: a11e2293-c7ca-4d3a-9e0f-ebcfa337159d
  type: databaseSchema
  name: sys
  fullyQualifiedName: oracle_test.default.sys
  displayName: sys
  deleted: false
database:
  id: 635299d9-9c3d-4ccc-98ff-dfb95889d8d6
  type: database
  name: default
  fullyQualifiedName: oracle_test.default
  displayName: default
  deleted: false
service:
  id: 81062063-d522-406b-92a3-ccad1f68f1ad
  type: databaseService
  name: oracle_test
  fullyQualifiedName: oracle_test
  displayName: oracle_test
  deleted: false
serviceType: Oracle
owners: []
tags: []
domains: []
sourceHash: 7367aebd398efc4dddc00e7646d610b8
processedLineage: false
entityStatus: Approved
