name: DBMS_FEATURE_EXTENSIBILITY
fullyQualifiedName: oracle_test.default.sys.DBMS_FEATURE_EXTENSIBILITY
storedProcedureCode:
  language: SQL
  code: |2-
      num_user_opts         number;
    PROCEDURE DBMS_FEATURE_EXTENSIBILITY
         ( feature_boolean  OUT  NUMBER,
           aux_count        OUT  NUMBER,
           feature_info     OUT  CLOB)
    AS
      num_user_aggs         number;
      num_table_funs        number;
      num_idx_types         number;
      num_domain_idxs       number;
      feature_usage         varchar2(1000);
      TYPE cursor_t         IS REF CURSOR;
      cursor_udftype        cursor_t;
      total_count           number;
      flag                  number;

    begin
      --initialize
      num_user_opts         :=0;
      num_user_aggs         :=0;
      num_table_funs        :=0;
      num_idx_types         :=0;
      num_domain_idxs       :=0;
      total_count           :=0;
      flag                  :=0;



      feature_boolean := 0;
      aux_count := 0;
      /* get number of user-defined operators */
      execute immediate 'select count(*) from DBA_OPERATORS
              where owner not in (select schema_name from v$sysaux_occupants)
              and owner not in (''SH'')'
              into num_user_opts;

      /* get number of user-defined index types */
      execute immediate 'select count(*)
              from sys.indtypes$ i, sys.user$ u, sys.obj$ o
              where i.obj# = o.obj# and o.owner# = u.user# and
                    u.name not in (select schema_name from v$sysaux_occupants)
                    and u.name not in (''SH'')'
              into num_idx_types;

      /* get number of user-defined domain indexes */
      execute immediate 'select count(*) from sys.user$ u, sys.ind$ i, sys.obj$ o
              where u.user# = o.owner# and o.obj# = i.obj# and
                    i.type# = 9 and
                    u.name not in (select schema_name from v$sysaux_occupants)
                    and u.name not in (''SH'')'
              into num_domain_idxs;

      /* get number of user-defined aggregates and user-defined
       * pipelined table functions
       */
      OPEN cursor_udftype FOR '
        select count(*), bitand(p.properties, 24)
        from sys.obj$ o, sys.user$ u, sys.procedureinfo$ p
        where o.owner# = u.user# and o.obj# = p.obj# and
              bitand(p.properties, 24) != 0 and
              u.name not in (select schema_name from v$sysaux_occupants)
              and u.name not in (''SH'', ''DVSYS'')
        group by (bitand(p.properties, 24))';

      LOOP
        BEGIN
          FETCH cursor_udftype INTO total_count, flag;
          EXIT WHEN cursor_udftype%NOTFOUND;

          IF flag = 8 THEN
            num_user_aggs := total_count;
          END IF;

          IF flag = 16 THEN
            num_table_funs := total_count;
          END IF;
        END;
      END LOOP;

      if ((num_user_opts > 0) OR (num_user_aggs > 0) OR (num_table_funs > 0)
          OR (num_idx_types > 0) OR (num_domain_idxs > 0)) then
        feature_boolean := 1;
        feature_usage := 'num of user-defined operators: ' || to_char(num_user_opts) ||
            ',' || 'num of user-defined aggregates: ' || to_char(num_user_aggs) ||
            ',' || 'num of table functions: ' || to_char(num_table_funs) ||
            ',' || 'num of index types: ' || to_char(num_idx_types) ||
            ',' || 'num of domain indexes: ' || to_char(num_domain_idxs);

        feature_info := to_clob(feature_usage);
      else
        feature_info := to_clob('EXTENSIBILITY usage not detected');
      end if;

    end;
dataProducts: []
storedProcedureType: StoredProcedure
databaseSchema:
  id: a11e2293-c7ca-4d3a-9e0f-ebcfa337159d
  type: databaseSchema
  name: sys
  fullyQualifiedName: oracle_test.default.sys
  displayName: sys
  deleted: false
database:
  id: 635299d9-9c3d-4ccc-98ff-dfb95889d8d6
  type: database
  name: default
  fullyQualifiedName: oracle_test.default
  displayName: default
  deleted: false
service:
  id: 81062063-d522-406b-92a3-ccad1f68f1ad
  type: databaseService
  name: oracle_test
  fullyQualifiedName: oracle_test
  displayName: oracle_test
  deleted: false
serviceType: Oracle
owners: []
tags: []
domains: []
sourceHash: 909b4732fff1c319bb2415df9774d30c
processedLineage: false
entityStatus: Approved
