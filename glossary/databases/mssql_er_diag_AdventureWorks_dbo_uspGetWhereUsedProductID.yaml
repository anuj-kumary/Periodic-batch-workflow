name: uspGetWhereUsedProductID
fullyQualifiedName: mssql_er_diag.AdventureWorks.dbo.uspGetWhereUsedProductID
storedProcedureCode:
  language: SQL
  code: "\r\nCREATE PROCEDURE [dbo].[uspGetWhereUsedProductID]\r\n    @StartProductID\
    \ [int],\r\n    @CheckDate [datetime]\r\nAS\r\nBEGIN\r\n    SET NOCOUNT ON;\r\n\
    \r\n    --Use recursive query to generate a multi-level Bill of Material (i.e.\
    \ all level 1 components of a level 0 assembly, all level 2 components of a level\
    \ 1 assembly)\r\n    WITH [BOM_cte]([ProductAssemblyID], [ComponentID], [ComponentDesc],\
    \ [PerAssemblyQty], [StandardCost], [ListPrice], [BOMLevel], [RecursionLevel])\
    \ -- CTE name and columns\r\n    AS (\r\n        SELECT b.[ProductAssemblyID],\
    \ b.[ComponentID], p.[Name], b.[PerAssemblyQty], p.[StandardCost], p.[ListPrice],\
    \ b.[BOMLevel], 0 -- Get the initial list of components for the bike assembly\r\
    \n        FROM [Production].[BillOfMaterials] b\r\n            INNER JOIN [Production].[Product]\
    \ p \r\n            ON b.[ProductAssemblyID] = p.[ProductID] \r\n        WHERE\
    \ b.[ComponentID] = @StartProductID \r\n            AND @CheckDate >= b.[StartDate]\
    \ \r\n            AND @CheckDate <= ISNULL(b.[EndDate], @CheckDate)\r\n      \
    \  UNION ALL\r\n        SELECT b.[ProductAssemblyID], b.[ComponentID], p.[Name],\
    \ b.[PerAssemblyQty], p.[StandardCost], p.[ListPrice], b.[BOMLevel], [RecursionLevel]\
    \ + 1 -- Join recursive member to anchor\r\n        FROM [BOM_cte] cte\r\n   \
    \         INNER JOIN [Production].[BillOfMaterials] b \r\n            ON cte.[ProductAssemblyID]\
    \ = b.[ComponentID]\r\n            INNER JOIN [Production].[Product] p \r\n  \
    \          ON b.[ProductAssemblyID] = p.[ProductID] \r\n        WHERE @CheckDate\
    \ >= b.[StartDate] \r\n            AND @CheckDate <= ISNULL(b.[EndDate], @CheckDate)\r\
    \n        )\r\n    -- Outer select from the CTE\r\n    SELECT b.[ProductAssemblyID],\
    \ b.[ComponentID], b.[ComponentDesc], SUM(b.[PerAssemblyQty]) AS [TotalQuantity]\
    \ , b.[StandardCost], b.[ListPrice], b.[BOMLevel], b.[RecursionLevel]\r\n    FROM\
    \ [BOM_cte] b\r\n    GROUP BY b.[ComponentID], b.[ComponentDesc], b.[ProductAssemblyID],\
    \ b.[BOMLevel], b.[RecursionLevel], b.[StandardCost], b.[ListPrice]\r\n    ORDER\
    \ BY b.[BOMLevel], b.[ProductAssemblyID], b.[ComponentID]\r\n    OPTION (MAXRECURSION\
    \ 25) \r\nEND;\r\n"
dataProducts: []
databaseSchema:
  id: 132f7568-1b61-4741-b025-fcb70f1abf0b
  type: databaseSchema
  name: dbo
  fullyQualifiedName: mssql_er_diag.AdventureWorks.dbo
  displayName: dbo
  deleted: false
database:
  id: 1e3c79a9-c852-4475-87ab-b32cd25abb0f
  type: database
  name: AdventureWorks
  fullyQualifiedName: mssql_er_diag.AdventureWorks
  displayName: AdventureWorks
  deleted: false
service:
  id: 1fed7fdb-1405-4a27-b2e0-1f420f2be98b
  type: databaseService
  name: mssql_er_diag
  fullyQualifiedName: mssql_er_diag
  displayName: mssql_er_diag
  deleted: false
serviceType: Mssql
owners: []
tags: []
domains: []
sourceHash: ec2071356a375e7d681dc97d22a2b88c
processedLineage: false
entityStatus: Approved
